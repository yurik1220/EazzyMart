<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Grocery Store</title>

  <!-- Bootswatch (Brite) + Animate.css -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.8/dist/brite/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>



  <style>
    /* === GLOBAL STYLING === */
    body {
      background: linear-gradient(135deg, #e8f0ff 0%, #fdfbff 100%);
      font-family: 'Poppins', sans-serif;
      color: #333;
      backdrop-filter: blur(8px);
      min-height: 100vh;
      overflow-x: hidden;
      transition: background 0.5s ease;
    }

    /* === SIDEBAR === */
    aside {
      min-height: 100vh;
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(12px);
      border-right: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 4px 0 16px rgba(0, 0, 0, 0.05);
      transition: all 0.4s ease;
    }

    aside h2 {
      font-weight: 600;
      color: #212529;
    }

    .sidebar-link {
      color: #212529 !important;
      border-radius: 12px;
      margin: 4px 8px;
      padding: 10px 15px;
      transition: all 0.25s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 500;
    }

    .sidebar-link:hover {
      background: rgba(13, 110, 253, 0.08);
      transform: translateX(5px);
    }

    .sidebar-link.active {
      background-color: rgba(13, 110, 253, 0.2) !important;
      color: #0d6efd !important;
      font-weight: 600;
      box-shadow: 0 3px 10px rgba(13, 110, 253, 0.15);
    }

    /* === MOBILE SIDEBAR === */
    @media (max-width: 767.98px) {
      aside {
        position: fixed;
        left: -260px;
        top: 0;
        width: 260px;
        z-index: 1040;
      }

      aside.show {
        left: 0;
      }

      .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.4);
        z-index: 1030;
      }

      .overlay.show {
        display: block;
      }

      main {
        padding: 1.5rem;
      }
    }

    /* === MAIN CONTENT === */
    main {
      padding: 2rem;
      transition: margin-left 0.4s ease;
    }

    /* === CARDS === */
    .card {
      border: none;
      border-radius: 18px;
      background: rgba(255, 255, 255, 0.5);
      backdrop-filter: blur(12px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
    }

    /* === BUTTONS === */
    .btn {
      border-radius: 10px;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    /* === TITLES === */
    h1, h5 {
      font-weight: 600;
      color: #212529;
    }

    /* === FORM === */
    form {
      background: rgba(255, 255, 255, 0.6);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.05);
    }

    /* === FOOTER TEXT === */
    .footer {
      color: rgba(0,0,0,0.5);
    }
  </style>
</head>
<body>
    <!-- LOGIN SECTION -->
<section id="login-section" class="d-flex justify-content-center align-items-center position-fixed top-0 start-0 w-100 h-100 bg-light bg-opacity-75" style="z-index: 1050;">
  <div class="card p-4" style="width: 350px;">
    <h3 class="mb-3 text-center">Admin Login</h3>
    <form id="login-form">
      <div class="mb-3">
        <label for="login-username" class="form-label">Username</label>
        <input type="text" id="login-username" class="form-control" placeholder="Enter username" required>
      </div>
      <div class="mb-3">
        <label for="login-password" class="form-label">Password</label>
        <input type="password" id="login-password" class="form-control" placeholder="Enter password" required>
      </div>
      <button type="submit" class="btn btn-primary w-100">Login</button>
    </form>
  </div>
</section>
  <!-- Overlay for mobile -->
  <div class="overlay" id="overlay"></div>

  <div class="container-fluid">
    <div class="row flex-nowrap">
      <!-- SIDEBAR -->
      <aside class="col-auto col-md-3 col-xl-2 p-3 d-flex flex-column" id="sidebar">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="fs-5 mb-0">üõí Grocery Admin</h2>
          <button class="btn btn-sm btn-light d-md-none" id="close-sidebar">&times;</button>
        </div>

        <ul class="nav nav-pills flex-column mb-auto">
          <li><a href="#" class="nav-link sidebar-link active" data-section="dashboard">üè† Dashboard</a></li>
          <li><a href="#" class="nav-link sidebar-link" data-section="add-item">‚ûï Add Item</a></li>
          <li><a href="#" class="nav-link sidebar-link" data-section="view-items">üì¶ View Items</a></li>
          <li><a href="#" class="nav-link sidebar-link" data-section="report">üìä Sales Report</a></li>
          <li class="mt-3 text-center">
          <button id="openCashierBtn" class="btn btn-outline-success w-100 shadow-sm">üíº Open Cashier Panel</button>
          </li>
        </ul>
        <hr class="mt-auto">
        <div class="text-center small footer">&copy; 2025 Grocery Store</div>
      </aside>

      <!-- MAIN CONTENT -->
      <main class="col d-none">
        <button class="btn btn-primary mb-3 d-md-none" id="toggle-sidebar">‚ò∞ Menu</button>

        <!-- DASHBOARD -->
        <section id="dashboard" class="section animate__animated animate__fadeIn">
          <h1 class="mb-4">üìä Dashboard</h1>
          <div class="row g-3 mb-4">
            <div class="col-12 col-md-4">
              <div class="card text-center">
                <div class="card-body">
                  <h5>Total Items</h5>
                  <p id="total-items" class="fs-3 fw-bold">0</p>
                </div>
              </div>
            </div>
            <div class="col-12 col-md-4">
              <div class="card text-center">
                <div class="card-body">
                  <h5>Total Stock</h5>
                  <p id="total-stock" class="fs-3 fw-bold">0</p>
                </div>
              </div>
            </div>
            <div class="col-12 col-md-4">
              <div class="card text-center">
                <div class="card-body">
                  <h5>Total Value</h5>
                  <p id="total-value" class="fs-3 fw-bold">‚Ç±0.00</p>
                </div>
              </div>
            </div>
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-6">
              <div class="card">
                <div class="card-body">
                  <h5>üì¶ Category Distribution</h5>
                  <canvas id="categoryChart" height="250"></canvas>
                </div>
              </div>
            </div>
            <div class="col-12 col-md-6">
              <div class="card">
                <div class="card-body">
                  <h5>üìà Stock Analysis</h5>
                  <canvas id="stockChart" height="250"></canvas>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- ADD ITEM -->
        <section id="add-item" class="section d-none animate__animated animate__fadeIn">
          <h1 class="mb-4">‚ûï Add Item</h1>
          <form id="add-item-form" class="p-4 shadow-sm">
            <div class="mb-3">
              <label for="item-name" class="form-label">Item Name</label>
              <input type="text" id="item-name" class="form-control" placeholder="Enter item name" required>
            </div>

            <div class="mb-3">
  <label for="item-category" class="form-label">Category</label>
  <select id="item-category" class="form-select" required>
    <option value="">Select Category</option>
    <option value="Fresh Produce">üçé Fresh Produce</option>
    <option value="Meat & Poultry">ü•© Meat & Poultry</option>
    <option value="Bakery">üçû Bakery</option>
    <option value="Dairy">ü•õ Dairy</option>
    <option value="Snacks">üç´ Snacks</option>
    <option value="Personal Care">üß¥ Personal Care</option>
    <option value="Household">üßπ Household</option>
    <option value="Kitchen Essentials">üçΩÔ∏è Kitchen Essentials</option>
  </select>
</div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="item-price" class="form-label">Price (‚Ç±)</label>
                <input type="number" id="item-price" class="form-control" step="0.01" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="item-stock" class="form-label">Stock Quantity</label>
                <input type="number" id="item-stock" class="form-control" required>
              </div>
            </div>

            <div class="mb-3">
              <label for="item-image-file" class="form-label">Upload Image</label>
              <input type="file" id="item-image-file" class="form-control" accept="image/*">
            </div>

            <div class="mb-3">
              <label for="item-description" class="form-label">Description</label>
              <textarea id="item-description" class="form-control" rows="3" placeholder="Enter item description" required></textarea>
            </div>

            <button type="submit" class="btn btn-success w-100">Add Item</button>

            <hr class="my-5">
<h3 class="mb-3">üìÇ Bulk Upload (Excel)</h3>

<div class="p-3 border rounded bg-white bg-opacity-75 shadow-sm">
  <p class="text-muted small mb-2">Upload an Excel file (.xlsx) with columns:
    <b>Name, Category, Price, Stock, Description</b>.
  </p>

  <input type="file" id="excel-file" accept=".xlsx,.xls" class="form-control mb-3">

  <button id="preview-excel" class="btn btn-outline-primary w-100 mb-3">Preview Excel</button>
  <div id="excel-preview" class="table-responsive mt-3" style="display:none;">
    <table class="table table-bordered table-sm align-middle text-center">
      <thead class="table-light">
        <tr>
          <th>Name</th>
          <th>Category</th>
          <th>Price</th>
          <th>Stock</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button id="upload-excel" class="btn btn-success mt-3 w-100">Upload All to Database</button>
  </div>
</div>
          </form>
        </section>

        <!-- VIEW ITEMS -->
        <section id="view-items" class="section d-none animate__animated animate__fadeIn">
          <h1 class="mb-4">üì¶ View Items</h1>
          <input type="text" id="search-bar" class="form-control mb-3" placeholder="Search items...">
          <div id="product-list" class="row g-3"></div>
        </section>

        <!-- REPORT -->
        <section id="report" class="section d-none animate__animated animate__fadeIn">
          <h1 class="mb-4">üìä Sales Report</h1>
          <button id="generate-report" class="btn btn-primary mb-3">Generate Report</button>
          <button id="export-pdf" class="btn btn-primary mb-3">Export to PDF</button>
          <div id="report-output" class="mt-3"></div>
        </section>
      </main>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="./node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const toggleBtn = document.getElementById('toggle-sidebar');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    const closeBtn = document.getElementById('close-sidebar');

    toggleBtn?.addEventListener('click', () => {
      sidebar.classList.add('show');
      overlay.classList.add('show');
    });

    overlay?.addEventListener('click', () => {
      sidebar.classList.remove('show');
      overlay.classList.remove('show');
    });

    closeBtn?.addEventListener('click', () => {
      sidebar.classList.remove('show');
      overlay.classList.remove('show');
    });
  </script>
  <script>
document.addEventListener('DOMContentLoaded', async () => {
  const categoryCtx = document.getElementById('categoryChart').getContext('2d');
  const stockCtx = document.getElementById('stockChart').getContext('2d');

  try {
    const res = await fetch('http://localhost:3000/api/items');
    const items = await res.json();

    if (!Array.isArray(items) || !items.length) {
      console.warn('No items found for charts');
      return;
    }

    // === Group items by category ===
    const categoryMap = {};
    items.forEach(item => {
      const category = item.category || 'Uncategorized';
      if (!categoryMap[category]) {
        categoryMap[category] = { count: 0, stock: 0 };
      }
      categoryMap[category].count += 1;
      categoryMap[category].stock += item.stock || 0;
    });

    const categories = Object.keys(categoryMap);
    const itemCounts = categories.map(c => categoryMap[c].count);
    const stockCounts = categories.map(c => categoryMap[c].stock);

    // === Pie Chart: Category Distribution ===
    new Chart(categoryCtx, {
      type: 'pie',
      data: {
        labels: categories,
        datasets: [{
          label: 'Category Distribution',
          data: itemCounts,
          backgroundColor: [
            '#ff6384','#36a2eb','#ffcd56','#4bc0c0','#9966ff','#ff9f40','#8bc34a','#795548'
          ]
        }]
      },
      options: {
        responsive: true,
        plugins: {
          title: {
            display: true,
            text: 'Product Category Distribution',
            font: { size: 18 }
          },
          legend: { position: 'right' }
        }
      }
    });

    // === Bar Chart: Stock Analysis ===
    new Chart(stockCtx, {
      type: 'bar',
      data: {
        labels: categories,
        datasets: [{
          label: 'Stock Count',
          data: stockCounts,
          backgroundColor: '#36a2eb'
        }]
      },
      options: {
        responsive: true,
        plugins: {
          title: {
            display: true,
            text: 'Stock Analysis by Category',
            font: { size: 18 }
          }
        },
        scales: {
          y: { beginAtZero: true }
        }
      }
    });

  } catch (err) {
    console.error('Chart data error:', err);
  }
});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const excelInput = document.getElementById('excel-file');
  const previewBtn = document.getElementById('preview-excel');
  const uploadBtn = document.getElementById('upload-excel');
  const previewContainer = document.getElementById('excel-preview');
  const previewTableBody = previewContainer?.querySelector('tbody');

  let parsedItems = [];

  // === PREVIEW EXCEL CONTENT ===
  previewBtn?.addEventListener('click', async (e) => {
    e.preventDefault();
    if (!excelInput.files.length) {
      Swal.fire('No File Selected', 'Please upload an Excel file first.', 'warning');
      return;
    }

    const file = excelInput.files[0];
    const reader = new FileReader();

    reader.onload = (event) => {
      const data = new Uint8Array(event.target.result);
      const workbook = XLSX.read(data, { type: 'array' });
      const sheetName = workbook.SheetNames[0];
      const worksheet = workbook.Sheets[sheetName];
      const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

      // Expect header row
      const [headers, ...rows] = jsonData;
      parsedItems = [];

      if (!headers || headers.length < 3) {
        Swal.fire('Invalid Format', 'Make sure the first row contains headers like Name, Category, Price, Stock, Description.', 'error');
        return;
      }

      previewTableBody.innerHTML = '';
      rows.forEach(row => {
        if (row.length >= 3) {
          const [name, category, price, stock, description] = row;
          parsedItems.push({
            name: name?.toString().trim() || 'Unnamed',
            category: category?.toString().trim() || 'Uncategorized',
            price: Number(price) || 0,
            stock: Number(stock) || 0,
            description: description?.toString().trim() || ''
          });

          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${name || ''}</td>
            <td>${category || ''}</td>
            <td>${price || ''}</td>
            <td>${stock || ''}</td>
            <td>${description || ''}</td>
          `;
          previewTableBody.appendChild(tr);
        }
      });

      if (parsedItems.length > 0) {
        previewContainer.style.display = 'block';
        Swal.fire('Preview Ready', `${parsedItems.length} items found.`, 'success');
      } else {
        Swal.fire('No Items Found', 'The Excel file appears empty.', 'warning');
      }
    };

    reader.readAsArrayBuffer(file);
  });

  // === UPLOAD ALL TO BACKEND ===
  uploadBtn?.addEventListener('click', async (e) => {
    e.preventDefault();
    if (!parsedItems.length) {
      Swal.fire('Nothing to Upload', 'Please preview an Excel file first.', 'warning');
      return;
    }

    try {
      const res = await fetch('http://localhost:3000/api/items/bulk', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ items: parsedItems })
      });

      const data = await res.json();
      if (!res.ok || !data.success) throw new Error(data.message || 'Upload failed');

      Swal.fire('‚úÖ Upload Complete', `${parsedItems.length} items added successfully!`, 'success');
      parsedItems = [];
      previewContainer.style.display = 'none';
      excelInput.value = '';
    } catch (err) {
      console.error(err);
      Swal.fire('Error', err.message || 'Upload failed.', 'error');
    }
  });
});
</script>
  <script src="adminscript-copy.js"></script>
</body>
</html>
